image: Visual Studio 2017
version: '3.0.64.{build}'
configuration: Release
platform: x64
branches:
    only:
        - port64
        - ci

environment:
    matrix:
        - PYTHON: "C:\\Python35-x64"

install:
    - cmd: set PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%
    - git submodule update --init --recursive

before_build:
    - cmd: tools\\build_boost.bat

build:
    project: JContainers.sln

after_build:
    - cmd: python tools\\install.py x64\\Release

test_script:
    - cmd: python tools\\test.py x64\\Release\\Data\\SKSE\\Plugins\\JContainers.dll

artifacts:
    - path: dist\*

deploy:
    release: JContainers64-v$(appveyor_build_version)
    description: 'N / A'
    provider: GitHub
    auth_token:
        secure: PtvvT2sUdf1BOAi7m39Sm/2Qh1X8wGVGoHnvKyxMBCirRWJIhbhoOlX5GoF+kDya
    artifact: dist\*
    force_update: true
    draft: false
    prerelease: true
